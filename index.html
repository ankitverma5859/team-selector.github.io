<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Scrum Team Selector - Straumann</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          "Helvetica Neue", Arial, sans-serif;
        background: linear-gradient(135deg, #f5f7fa 0%, #e8ecf1 100%);
        min-height: 100vh;
        color: #1d1d1f;
        padding: 20px;
        overflow-x: hidden;
      }

      .header {
        text-align: center;
        margin-bottom: 40px;
        animation: fadeIn 0.6s ease-out;
      }

      .logo-title {
        font-size: 32px;
        font-weight: 600;
        letter-spacing: -0.5px;
        color: #1d1d1f;
        margin-bottom: 8px;
      }

      .date-display {
        font-size: 15px;
        color: #86868b;
        font-weight: 400;
        margin-bottom: 24px;
      }

      .host-container {
        display: flex;
        justify-content: center;
        gap: 40px;
        margin-bottom: 20px;
        flex-wrap: wrap;
      }

      .host-card {
        background: rgba(255, 255, 255, 0.7);
        backdrop-filter: blur(20px);
        border-radius: 16px;
        padding: 16px 28px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.06);
        border: 1px solid rgba(255, 255, 255, 0.8);
      }

      .host-label {
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 0.8px;
        color: #86868b;
        margin-bottom: 4px;
        font-weight: 500;
      }

      .host-name {
        font-size: 18px;
        font-weight: 600;
        color: #005eb8;
      }

      .main-container {
        max-width: 1200px;
        margin: 0 auto;
        display: grid;
        grid-template-columns: 1fr 1.2fr 1fr;
        gap: 24px;
        margin-bottom: 100px;
      }

      .column {
        background: rgba(255, 255, 255, 0.6);
        backdrop-filter: blur(20px);
        border-radius: 20px;
        padding: 28px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
        border: 1px solid rgba(255, 255, 255, 0.9);
        animation: fadeInUp 0.6s ease-out;
      }

      .column:nth-child(2) {
        animation-delay: 0.1s;
      }

      .column:nth-child(3) {
        animation-delay: 0.2s;
      }

      .column-title {
        font-size: 14px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 1px;
        color: #86868b;
        margin-bottom: 20px;
        text-align: center;
      }

      .team-list {
        list-style: none;
      }

      .team-item {
        background: white;
        border-radius: 12px;
        padding: 16px 18px;
        margin-bottom: 10px;
        font-size: 15px;
        font-weight: 500;
        color: #1d1d1f;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        border: 1px solid rgba(0, 0, 0, 0.04);
      }

      .team-item:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
      }

      .presenting-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 320px;
      }

      .current-team {
        background: linear-gradient(135deg, #005eb8 0%, #0074d9 100%);
        color: white;
        border-radius: 18px;
        padding: 40px 32px;
        text-align: center;
        font-size: 20px;
        font-weight: 600;
        box-shadow: 0 12px 40px rgba(0, 94, 184, 0.25);
        width: 100%;
        min-height: 140px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .current-team.active {
        animation: scaleIn 0.5s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .timer-display {
        margin-top: 24px;
        background: white;
        border-radius: 14px;
        padding: 20px 32px;
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.06);
        width: 100%;
      }

      .timer-label {
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 0.8px;
        color: #86868b;
        margin-bottom: 6px;
        font-weight: 500;
        text-align: center;
      }

      .timer-time {
        font-size: 32px;
        font-weight: 600;
        color: #1d1d1f;
        text-align: center;
        font-variant-numeric: tabular-nums;
      }

      .presented-item {
        background: white;
        border-radius: 12px;
        padding: 16px 18px;
        margin-bottom: 10px;
        font-size: 14px;
        color: #1d1d1f;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
        display: flex;
        justify-content: space-between;
        align-items: center;
        animation: slideInRight 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        border: 1px solid rgba(0, 0, 0, 0.04);
      }

      .time-badge {
        font-size: 12px;
        font-weight: 600;
        padding: 4px 10px;
        border-radius: 8px;
        font-variant-numeric: tabular-nums;
      }

      .time-success {
        background: #d4edda;
        color: #155724;
      }

      .time-danger {
        background: #f8d7da;
        color: #721c24;
      }

      .action-button {
        position: fixed;
        bottom: 30px;
        left: 50%;
        transform: translateX(-50%);
        background: linear-gradient(135deg, #005eb8 0%, #0074d9 100%);
        color: white;
        border: none;
        border-radius: 14px;
        padding: 18px 48px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        box-shadow: 0 8px 32px rgba(0, 94, 184, 0.3);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        z-index: 1000;
      }

      .action-button:hover:not(:disabled) {
        transform: translateX(-50%) translateY(-2px);
        box-shadow: 0 12px 40px rgba(0, 94, 184, 0.4);
      }

      .action-button:active:not(:disabled) {
        transform: translateX(-50%) translateY(0);
      }

      .action-button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      .nav-button {
        position: fixed;
        top: 20px;
        right: 20px;
        background: rgba(255, 255, 255, 0.7);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.8);
        border-radius: 12px;
        padding: 12px 24px;
        font-size: 14px;
        font-weight: 500;
        color: #005eb8;
        cursor: pointer;
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        z-index: 1000;
      }

      .nav-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.12);
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(-20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes scaleIn {
        from {
          transform: scale(0.9);
          opacity: 0;
        }
        to {
          transform: scale(1);
          opacity: 1;
        }
      }

      @keyframes slideInRight {
        from {
          transform: translateX(30px);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }

      @keyframes slideOut {
        from {
          transform: translateX(0);
          opacity: 1;
        }
        to {
          transform: translateX(-30px);
          opacity: 0;
        }
      }

      .slide-out {
        animation: slideOut 0.3s cubic-bezier(0.4, 0, 0.2, 1) forwards;
      }

      @media (max-width: 968px) {
        .main-container {
          grid-template-columns: 1fr;
        }

        .host-container {
          gap: 16px;
        }

        .column {
          padding: 20px;
        }
      }

      .empty-state {
        text-align: center;
        color: #86868b;
        font-size: 14px;
        padding: 40px 20px;
      }
      .nextWeekKt {
        filter: blur(6px);
      }

      /* KT Picker Styles */
      .spin-container {
        margin: 20px auto;
        width: 100%;
        max-width: 350px;
        height: 100px;
        overflow: hidden;
        border-radius: 12px;
        border: 3px solid #005eb8;
        box-shadow: 0 0 30px rgba(0, 94, 184, 0.3);
        position: relative;
        background: #f5f7fa;
        display: none;
      }

      .spin-container.active {
        display: block;
      }

      .reel {
        position: absolute;
        width: 100%;
        transition: transform 4s cubic-bezier(0.17, 0.67, 0.24, 1.3);
      }

      .name-item {
        height: 100px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
        font-weight: 500;
        color: #1d1d1f;
        filter: blur(8px);
        transition: filter 0.5s ease;
      }

      .name-item.reveal {
        filter: blur(0px);
      }

      .name-item.winner {
        color: #22c55e;
        font-weight: 600;
        filter: blur(0px);
      }

      .pointer {
        position: absolute;
        top: -16px;
        left: 50%;
        transform: translateX(-50%);
        font-size: 24px;
        color: #005eb8;
        z-index: 10;
      }

      .kt-title {
        font-size: 20px;
        font-weight: 600;
        color: #1d1d1f;
        text-align: center;
        margin-bottom: 16px;
        display: none;
      }

      .kt-title.active {
        display: block;
      }

      .kt-button {
        background: linear-gradient(135deg, #005eb8 0%, #0074d9 100%);
        color: white;
        border: none;
        border-radius: 14px;
        padding: 16px 40px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        box-shadow: 0 8px 32px rgba(0, 94, 184, 0.3);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        margin-top: 20px;
        display: none;
      }

      .kt-button.active {
        display: block;
      }

      .kt-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 12px 40px rgba(0, 94, 184, 0.4);
      }

      .kt-button:active {
        transform: translateY(0);
      }

      .kt-button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }
    </style>
  </head>
  <body>
    <button
      class="nav-button"
      onclick="window.location.href = 'smilemovement.html'"
    >
      Smile Movement
    </button>

    <div class="header">
      <div class="logo-title">Scrum Team Selector</div>
      <div class="date-display" id="currentDate"></div>
      <div class="host-container">
        <div class="host-card">
          <div class="host-label">Host Master</div>
          <div class="host-name" id="hostMaster"></div>
        </div>
        <div class="host-card">
          <div class="host-label">Host Standby</div>
          <div class="host-name" id="hostStandby"></div>
        </div>
        <div class="host-card">
          <div class="host-label">This week KT</div>
          <div class="host-name" id="nextWeekKt">Purushothama</div>
        </div>
      </div>
    </div>

    <div class="main-container">
      <div class="column">
        <div class="column-title">Teams to Present</div>
        <ul id="allTeams" class="team-list"></ul>
      </div>

      <div class="column">
        <div class="column-title">Currently Presenting</div>
        <div class="presenting-container">
          <div id="currentTeam" class="current-team">Ready to begin</div>
          <div class="spin-container" id="spinContainer">
            <div class="pointer">â–¼</div>
            <div id="reel" class="reel"></div>
          </div>
          <div class="timer-display" id="timerDisplay">
            <div class="timer-label">Elapsed Time</div>
            <div class="timer-time" id="elapsedTime">0:00</div>
          </div>
          <button class="kt-button" id="ktButton" onclick="handleKTSelection()">
            Select Presenter
          </button>
        </div>
      </div>

      <div class="column">
        <div class="column-title">Presented</div>
        <ul id="chosenTeams" class="team-list">
          <div class="empty-state">No teams yet</div>
        </ul>
      </div>
    </div>

    <button
      id="generateButton"
      class="action-button"
      onclick="handleButtonClick()"
    >
      Choose Team
    </button>

    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <script>
      const teams = [
        { number: 0, name: "[ST-404] Scrum Team NOT FOUND?" },
        { number: 1, name: "[ST-1] Scrum Team CCPS" },
        { number: 9, name: "[ST-3] Team Dolphin" },
        { number: 5, name: "[ST-5] Team SiAB" },
        { number: 7, name: "[ST-7] Team Owls" },
        { number: 8, name: "[ST-8] Team Eagle" },
      ];

      let currentTeam = null;
      let startTime = null;
      let timerInterval = null;
      let teamInfinityAdded = false;
      let teamInfinityDone = false;
      let ktPickerActive = false;
      let ktPresenterSelected = false;

      // KT Presenter tracking - add names here that have already presented
      const alreadyPresented = [];
      // Master list of all KT names
      const ktMasterList = [
        "Anil",
        "Arjun",
        "Aneesh",
        "Bala",
        "Kanchan",
        "Madan",
        "Madhu",
        "Mahesh",
        "Karthik",
        "Jaipal",
        "Harsha",
        "Sreeram",
        "Kavya",
        "Kavitha",
        "Sunil",
        "Rajyogi",
        "Pankaj",
        "Deeksith",
        "Purush",
        "Sneha",
        "Anand",
        "Ankit",
        "Paras",
        "Manish",
        "Amit",
        "Anupriya",
        "Natesh",
        "Rohan",
        "Kishore",
        "Chethan",
        "Sushmitha",
        "Harsith",
        "Prakriti",
        "Pooja",
        "Abhishek",
        "Rahul",
      ];

      const hosts = [
        "Pankaj",
        "Anil",
        "Manoj",
        "Rohan",
        "Sneha",
        "Bhoomi",
        "Kanchan",
        "Rohit",
        "Jaipal",
        "Chethan",
        "Sreeram",
        "Purush",
        "Paras",
        "Arjun",
        "Amit",
        "Harsith",
        "Sushmitha",
        "Deekshith",
        "Prakriti",
        "Karan",
        "Srilakshmi",
        "Sheel",
        "Madan",
        "Kavya",
        "Manish",
        "Chirag",
        "Karthik",
        "Anupriya",
        "Madhu",
        "Pooja",
        "Sharmistha",
        "Aneesh",
        "Rahul",
        "Abhishek",
      ];

      function setDate() {
        const date = new Date();
        const options = {
          weekday: "long",
          year: "numeric",
          month: "long",
          day: "numeric",
        };
        let formattedDate = date.toLocaleDateString("en-US", options);

        const day = date.getDate();
        const suffix =
          day % 10 === 1 && day !== 11
            ? "st"
            : day % 10 === 2 && day !== 12
              ? "nd"
              : day % 10 === 3 && day !== 13
                ? "rd"
                : "th";
        formattedDate = formattedDate.replace(day, `${day}${suffix}`);

        document.getElementById("currentDate").innerText = formattedDate;
      }

      function getGlobalWeeklyHost(list) {
        if (!Array.isArray(list) || list.length === 0) {
          throw new Error("The list must be a non-empty array.");
        }

        const now = new Date();
        const dayOfWeek = now.getUTCDay();
        const diff = (dayOfWeek === 0 ? -6 : 1) - dayOfWeek;
        const monday = new Date(now);
        monday.setUTCDate(now.getUTCDate() + diff);
        const weekStart = monday.toISOString().split("T")[0];

        const seed = weekStart
          .split("")
          .reduce((acc, char) => acc + char.charCodeAt(0), 0);

        const index1 =
          Math.floor(Math.abs(Math.sin(seed)) * list.length) % list.length;
        const hostMaster = list[index1];

        let index2 =
          Math.floor(Math.abs(Math.cos(seed)) * list.length) % list.length;
        if (index2 === index1) {
          index2 = (index1 + 1) % list.length;
        }
        const hostStandby = list[index2];

        return { hostMaster, hostStandby, weekStart };
      }

      function setHost() {
        const { hostMaster, hostStandby } = getGlobalWeeklyHost(hosts);
        //document.getElementById('hostMaster').innerText = hostMaster;
        //document.getElementById('hostStandby').innerText = hostStandby;
        document.getElementById("hostMaster").innerText = "Kavitha";
        document.getElementById("hostStandby").innerText = "Anil";
      }

      function initializeTeamsList() {
        const allTeamsList = document.getElementById("allTeams");
        teams.forEach((team) => {
          const listItem = document.createElement("li");
          listItem.className = "team-item";
          listItem.innerText = team.name;
          listItem.dataset.teamName = team.name;
          allTeamsList.appendChild(listItem);
        });
      }

      function startTimer() {
        clearInterval(timerInterval);
        startTime = new Date();

        timerInterval = setInterval(() => {
          const now = new Date();
          const elapsedSeconds = Math.floor((now - startTime) / 1000);
          const minutes = Math.floor(elapsedSeconds / 60);
          const seconds = elapsedSeconds % 60;
          document.getElementById("elapsedTime").innerText =
            `${minutes}:${seconds.toString().padStart(2, "0")}`;
        }, 1000);
      }

      function stopTimer() {
        clearInterval(timerInterval);
      }

      // KT Picker functions
      function shuffle(a) {
        return [...a].sort(() => Math.random() - 0.5);
      }

      function buildReel() {
        const reel = document.getElementById("reel");
        reel.innerHTML = "";

        // Filter out already presented names from master list
        const availableNames = ktMasterList.filter(
          (name) => !alreadyPresented.includes(name),
        );

        // If all names have been presented, use the full master list
        const namesToUse =
          availableNames.length > 0 ? availableNames : ktMasterList;

        const shuffledNames = shuffle(namesToUse);
        const longList = [...shuffledNames, ...shuffledNames, ...shuffledNames];

        longList.forEach((name) => {
          const div = document.createElement("div");
          div.className = "name-item";
          div.innerText = name;
          reel.appendChild(div);
        });
      }

      function spinKTPicker() {
        // Disable button during spin
        const ktButton = document.getElementById("ktButton");
        ktButton.disabled = true;

        // Hide current team display and show spin container
        document.getElementById("currentTeam").style.display = "none";
        document.getElementById("spinContainer").style.display = "block";

        const reel = document.getElementById("reel");

        // Reset reel position without transition
        reel.style.transition = "none";
        reel.style.transform = "translateY(0)";

        // Rebuild reel for fresh spin
        buildReel();

        // Force reflow to apply the reset
        void reel.offsetHeight;

        // Re-enable transition
        reel.style.transition =
          "transform 4s cubic-bezier(0.17, 0.67, 0.24, 1.3)";

        // Small delay to ensure reel is built before animating
        setTimeout(() => {
          // Reveal all names when spinning starts
          document.querySelectorAll(".name-item").forEach((el) => {
            el.classList.add("reveal");
          });

          // Filter out already presented names from master list
          const availableNames = ktMasterList.filter(
            (name) => !alreadyPresented.includes(name),
          );
          const namesToUse =
            availableNames.length > 0 ? availableNames : ktMasterList;

          const shuffledNames = shuffle(namesToUse);
          const winner = shuffledNames[0];

          const index = shuffledNames.length * 2;
          const offset = index * 100;

          reel.style.transform = `translateY(-${offset}px)`;

          setTimeout(() => {
            document.querySelectorAll(".name-item").forEach((el) => {
              if (el.innerText === winner) {
                el.classList.add("winner");
              }
            });

            if (typeof confetti !== "undefined") {
              confetti({
                particleCount: 150,
                spread: 80,
                origin: { y: 0.6 },
              });
            }

            const currentTeamDisplay = document.getElementById("currentTeam");
            currentTeamDisplay.style.display = "flex";
            currentTeamDisplay.innerText =
              winner + " will present KT next week!";
            currentTeamDisplay.style.background =
              "linear-gradient(135deg, #22c55e 0%, #16a34a 100%)";

            // Hide spin container but keep button
            document.getElementById("spinContainer").style.display = "none";

            // Change button to "Select Again"
            ktButton.innerText = "Select Again";
            ktButton.disabled = false;

            ktPresenterSelected = true;
            document.getElementById("generateButton").innerText = "End";
            document.getElementById("generateButton").style.display = "block";
          }, 4000);
        }, 100);
      }

      function generateRandomTeam() {
        const chosenTeamsList = document.getElementById("chosenTeams");

        if (currentTeam) {
          const endTime = new Date();
          const duration = Math.floor((endTime - startTime) / 1000);
          const minutes = Math.floor(duration / 60);
          const seconds = duration % 60;

          const timeDisplay = `${minutes}:${seconds.toString().padStart(2, "0")}`;
          const timeClass = duration < 180 ? "time-success" : "time-danger";

          if (chosenTeamsList.querySelector(".empty-state")) {
            chosenTeamsList.innerHTML = "";
          }

          const listItem = document.createElement("li");
          listItem.className = "presented-item";
          listItem.innerHTML = `
                    <span>${currentTeam.name}</span>
                    <span class="time-badge ${timeClass}">${timeDisplay}</span>
                `;
          chosenTeamsList.appendChild(listItem);
        }

        if (teams.length === 0 && !teamInfinityAdded) {
          document.getElementById("generateButton").innerText =
            "Move to KT Selector";
        }

        if (teams.length === 0 && teamInfinityAdded && !teamInfinityDone) {
          // Team Infinity is done, activate KT Picker
          teamInfinityDone = true;
          ktPickerActive = true;
          stopTimer();

          // Hide timer display and main button
          document.getElementById("timerDisplay").style.display = "none";
          document.getElementById("generateButton").style.display = "none";

          // Change column title to KT Presenter Selection
          document.querySelectorAll(".column-title")[1].innerText =
            "ðŸŽ¯ KT Presenter Selection";

          // Show KT elements
          document.getElementById("currentTeam").style.display = "none";
          document.getElementById("spinContainer").classList.add("active");
          document.getElementById("ktButton").classList.add("active");

          buildReel();
          return;
        }

        if (teams.length === 0 && !teamInfinityAdded) {
          teams.push({ number: 30, name: "[ST-100] Team Infinity" });
          teamInfinityAdded = true;

          const allTeamsList = document.getElementById("allTeams");
          const listItem = document.createElement("li");
          listItem.className = "team-item";
          listItem.innerText = "[ST-100] Team Infinity";
          listItem.dataset.teamName = "[ST-100] Team Infinity";
          allTeamsList.appendChild(listItem);
        }

        const randomIndex = Math.floor(Math.random() * teams.length);
        currentTeam = teams.splice(randomIndex, 1)[0];
        startTimer();

        const currentTeamDisplay = document.getElementById("currentTeam");
        currentTeamDisplay.classList.remove("active");
        void currentTeamDisplay.offsetWidth;
        currentTeamDisplay.classList.add("active");
        currentTeamDisplay.innerText = currentTeam.name;

        const allTeamsList = document.getElementById("allTeams");
        const items = allTeamsList.querySelectorAll(".team-item");
        items.forEach((item) => {
          if (item.dataset.teamName === currentTeam.name) {
            item.classList.add("slide-out");
            setTimeout(() => item.remove(), 300);
          }
        });
      }

      function handleKTSelection() {
        spinKTPicker();
      }

      function handleButtonClick() {
        if (ktPresenterSelected) {
          // End the session
          document.getElementById("generateButton").disabled = true;
          document.getElementById("generateButton").innerText = "Complete";
          stopTimer();
        } else {
          // Normal team selection
          generateRandomTeam();
        }
      }

      setDate();
      setHost();
      initializeTeamsList();
    </script>
  </body>
</html>
