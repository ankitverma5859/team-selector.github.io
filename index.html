<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scrum Team Selector</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        html, body {
            height: 100%;
            overflow-y: scroll;
        }
        body {
            margin: 0;
            /* Background image and subtle white overlay for lightness */
            background-image: linear-gradient(rgba(255, 255, 255, 0.7), rgba(255, 255, 255, 0.7)), url('navratri.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;

            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        .list-group {
            overflow-y: hidden;
        }
        .container {
            flex: 1;
            margin-bottom: 120px;
            border-radius: 8px;
            padding: 20px;
            
        }
        /* Hiding the main heading */
        .hidden-heading {
            display: none;
        }
        h4 {
            color: #333; /* Darker color for headings */
            text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.9); /* Subtle shadow for contrast */
        }
        p {
            color: #1a1a1a; /* Darker text for readability */
        }
        #generateButton {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
        }
        #timer {
            font-size: 1.2rem;
            font-weight: bold;
            text-align: center;
            margin: 10px 0;
            background: rgba(255, 255, 255, 0.8);
            padding: 10px;
            border-radius: 5px;
            /* Yellow/Gold theme */
            border: 2px solid #ffc400;
            color: #ffc400;
            box-shadow: 0 0 10px rgba(255, 196, 0, 0.4);
        }
        #resetButton {
            position: absolute;
            top: 20px;
            right: 20px;
        }
        /* Custom yellow button style */
        .btn-navratri-yellow {
            color: #333;
            background-color: #ffd700;
            border-color: #ccaa00;
            transition: background-color 0.3s ease;
        }
        .btn-navratri-yellow:hover {
            color: #333;
            background-color: #ffc400;
            border-color: #b38f00;
        }
        /* Primary button (Choose Scrum Team) changed to yellow theme */
        .btn-primary {
            color: #333;
            background-color: #ffd700;
            border-color: #ccaa00;
            transition: background-color 0.3s ease;
        }
        .btn-primary:hover {
            color: #333;
            background-color: #ffc400;
            border-color: #b38f00;
        }
        /* End of custom button style */
        #currentTeam {
            animation: glow 2s infinite alternate;
            background: rgba(255, 255, 255, 0.8);
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
        }
        .team-presenting {
            display: flex;
            flex-direction: column;
            height: 400px; /* Reverted to original height */
            border-radius: 5px;
            /* PUSHED DOWN BY 100PX */
            margin-top: 100px;
        }
        .slide-out {
            animation: slideOut 1s forwards;
        }
        .slide-in {
            animation: slideIn 1s forwards;
        }
        @keyframes slideOut {
            from {
                transform: translateX(0);
            }
            to {
                transform: translateX(-100%);
                opacity: 0;
            }
        }
        @keyframes slideIn {
            from {
                transform: translateX(100%);
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        /* Changed glow color to yellow/gold */
        @keyframes glow {
            from {
                box-shadow: 0 0 5px rgba(255, 196, 0, 0.5);
            }
            to {
                box-shadow: 0 0 15px rgba(255, 196, 0, 1);
            }
        }
        .time {
            font-size: 0.9rem;
            font-weight: bold;
        }
        .date {
            font-size: 1rem;
            text-align: center;
            margin-top: 10px;
            margin-bottom: 20px;
            color: #444;
        }
        .custom-padding {
            padding: 8px 10px;
            margin-bottom: 6px;
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 4px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
            font-size: 1rem;
            font-weight: 500;
        }
        .custom-padding:hover {
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.12);
            transform: translateY(-6px);
        }
        .host-name {
            color: #8B4513; /* Dark brown/saddle brown for contrast against light yellow theme */
            margin-left: 10px;
            text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.9);
        }
    </style>
</head>
<body>
    <button id="resetButton" class="btn btn-navratri-yellow" onclick="window.location.href='smilemovement.html'">Smile Movement</button>

    <div class="container py-5">
        <h1 class="text-center mb-2">Scrum Team Selector</h1> <!-- hidden-heading -->
        <p class="date" id="currentDate"></p>

<!--
        <p id="weeklyHost1" class="text-center"></p>
        <p id="weeklyHost2" class="text-center"></p>
        -->
    
        <p id="weeklyHost1" class="d-flex justify-content-end"></p>
        <p id="weeklyHost2" style="margin-top: -15px;" class="d-flex justify-content-end"></p>
            
        <div class="row" style="margin-top: 10px;">
            
            <div class="col-12 col-md-4">
                <h4 class="text-center">Teams to Present</h4>
                <ul id="allTeams" class="list-group">
                    <li class="list-group-item custom-padding">[ST-0] Scrum Team 0</li>
                    <li class="list-group-item custom-padding">[ST-1] Scrum Team 1</li>
                    <li class="list-group-item custom-padding">[ST-3] Team Dolphin</li>
                    <li class="list-group-item custom-padding">[ST-5] Team SiAB</li>
                    <li class="list-group-item custom-padding">[ST-7] Team Owls</li>
                    <li class="list-group-item custom-padding">[ST-8] Team Eagle</li>
                </ul>
            </div>
            
            <div class="col-12 col-md-4">
                <h4 class="text-center">Team Presenting</h4>
                <div class="team-presenting">
                    <p id="currentTeam" class="text-center p-3 border rounded bg-light mt-3">
                    </p>
                    <div id="timer">Timer: <span id="elapsedTime">0m 0s</span></div>
                </div>
            </div>
            
            <div class="col-12 col-md-4">
                <h4 class="text-center">Teams Presented</h4>
                <ul id="chosenTeams" class="list-group">
                    </ul>
            </div>
        </div>
    </div>
    
    <button id="generateButton" class="btn btn-primary" onclick="generateRandomTeam()">Choose Scrum Team</button>

    <script>
        const teams = [
            { number: 0, name: '[ST-0] Scrum Team 0' },
            { number: 1, name: '[ST-1] Scrum Team 1' },
            { number: 9, name: '[ST-3] Team Dolphin' },
            { number: 5, name: '[ST-5] Team SiAB' },
            { number: 7, name: '[ST-7] Team Owls' },
            { number: 8, name: '[ST-8] Team Eagle' },
        ];
        const usedTeams = [];
        let currentTeam = null;
        let startTime = null;
        let timerInterval = null;

        function setDate() {
            const date = new Date();
            const options = {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            };
            let formattedDate = date.toLocaleDateString('en-US', options);

            const day = date.getDate();
            const suffix = (day % 10 === 1 && day !== 11) ? 'st' :
                (day % 10 === 2 && day !== 12) ? 'nd' :
                (day % 10 === 3 && day !== 13) ? 'rd' : 'th';
            formattedDate = formattedDate.replace(day, `${day}${suffix}`);

            document.getElementById('currentDate').innerText = formattedDate;
        }

        function startTimer() {
            clearInterval(timerInterval);
            startTime = new Date();

            timerInterval = setInterval(() => {
                const now = new Date();
                const elapsedSeconds = Math.floor((now - startTime) / 1000);
                const minutes = Math.floor(elapsedSeconds / 60);
                const seconds = elapsedSeconds % 60;
                document.getElementById('elapsedTime').innerText = `${minutes}m ${seconds}s`;
            }, 1000);
        }
        function stopTimer() {
            clearInterval(timerInterval);
        }

        let teamInfinityAdded = false;
        function generateRandomTeam() {
            if (currentTeam) {
                const endTime = new Date();
                const duration = Math.floor((endTime - startTime) / 1000);
                const minutes = Math.floor(duration / 60);
                const seconds = duration % 60;

                const timeDisplay = `${minutes}m ${seconds}s`;
                const timeClass = duration < 180 ? 'text-success' : 'text-danger';

                const chosenTeamsList = document.getElementById('chosenTeams');
                const listItem = document.createElement('li');
                listItem.className = 'list-group-item slide-in custom-padding';
                listItem.innerHTML = `${currentTeam.name} <span class="time ${timeClass}">(${timeDisplay})</span>`;
                chosenTeamsList.appendChild(listItem);

            }
            if (teams.length === 0 && !teamInfinityAdded) {
                document.getElementById('generateButton').innerText = 'End';
            }
            if (teams.length === 0 && teamInfinityAdded) {
                document.getElementById('currentTeam').innerText = 'We are done with updates!';
                document.getElementById('generateButton').innerText = 'End';
                document.getElementById('generateButton').disabled = true;
                stopTimer()
                return;
            }
            if (teams.length === 0 && !teamInfinityAdded) {
                teams.push({ number: 30, name: '[ST-100] Team Infinity' });
                teamInfinityAdded = true;
            }
            const randomIndex = Math.floor(Math.random() * teams.length);
            currentTeam = teams.splice(randomIndex, 1)[0];
            startTimer();

            const currentTeamDisplay = document.getElementById('currentTeam');
            currentTeamDisplay.classList.remove('slide-in', 'slide-out');
            currentTeamDisplay.offsetWidth;
            currentTeamDisplay.classList.add('slide-in');
            currentTeamDisplay.innerText = currentTeam.name;

            const allTeamsList = document.getElementById('allTeams');
            const items = allTeamsList.getElementsByTagName('li');
            for (let i = 0; i < items.length; i++) {
                if (items[i].innerText === currentTeam.name) {
                    items[i].classList.add('slide-out');
                    setTimeout(() => items[i].remove(), 1000);
                    break;
                }
            }
        }

        function resetAll() {
            location.reload();
        }
        setDate();

        /**
         * Selects two unique hosts (Master and Standby) for the week 
         * from a rotational queue, ensuring a host isn't repeated 
         * until all hosts have been selected.
         */
        function getRotationalHosts(allHosts) {
            const STORAGE_KEY = 'hostRotationQueue';
            const PRESENT_HOST_KEY = 'currentWeekHosts';

            // 1. Get or initialize the queue
            let queue = JSON.parse(localStorage.getItem(STORAGE_KEY));
            
            // Check if the saved queue is empty or invalid (e.g., if new people were added/removed)
            if (!queue || queue.length === 0 || queue.length !== allHosts.length) {
                // Initialize/Reset the queue: start with a full, randomized list
                queue = [...allHosts];
                // Shuffle the array (Fisher-Yates shuffle)
                for (let i = queue.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [queue[i], queue[j]] = [queue[j], queue[i]];
                }
                localStorage.setItem(STORAGE_KEY, JSON.stringify(queue));
            }

            // 2. Get the host selection based on the current week's rotation
            
            // Determine the start date of the current week (e.g., Sunday)
            const now = new Date();
            const dayOfWeek = now.getDay(); // 0 for Sunday, 1 for Monday
            const daysSinceSunday = dayOfWeek;
            const weekStart = new Date(now.setDate(now.getDate() - daysSinceSunday)).toISOString().split('T')[0];

            // Check if hosts for this week are already stored
            let currentHosts = JSON.parse(localStorage.getItem(PRESENT_HOST_KEY));

            if (currentHosts && currentHosts.weekStart === weekStart) {
                // Hosts have already been selected this week, return them
                return { hostMaster: currentHosts.master, hostStandby: currentHosts.standby };
            }

            // 3. Select the hosts from the front of the queue
            
            // Select Master Host
            const hostMaster = queue.shift();
            
            // If the queue is now empty, it means we must reset it for the next selection
            if (queue.length === 0) {
                // Reset the queue for the next cycle, making sure the Master Host is added back
                queue = allHosts.filter(name => name !== hostMaster);
                // Reshuffle the new queue
                for (let i = queue.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [queue[i], queue[j]] = [queue[j], queue[i]];
                }
            }
            
            // Select Standby Host from the current or newly reset queue
            const hostStandby = queue.shift();
            
            // 4. Save the new state
            localStorage.setItem(STORAGE_KEY, JSON.stringify(queue));
            
            // Save the selected hosts for this week to maintain consistency until next week
            currentHosts = { master: hostMaster, standby: hostStandby, weekStart: weekStart };
            localStorage.setItem(PRESENT_HOST_KEY, JSON.stringify(currentHosts));

            return { hostMaster: hostMaster, hostStandby: hostStandby };
        }


        function getWeeklyHost(list) {
            if (!Array.isArray(list) || list.length === 0) {
                throw new Error("The list must be a non-empty array.");
            }
            const now = new Date();
            let date = new Date(now);

            const dayOfWeek = date.getDay();
            const daysToSubtract = (dayOfWeek === 6) ? 0 : dayOfWeek + 1;

            date.setDate(date.getDate() - daysToSubtract);

            const weekStart = date.toISOString().split('T')[0];

            const seed = weekStart.split('').reduce((acc, char) => acc + char.charCodeAt(0), 0);

            const index1 = Math.floor(Math.abs(Math.sin(seed) * list.length)) % list.length;
            const selectedHost1 = list[index1];

            let index2 = Math.floor(Math.abs(Math.cos(seed) * list.length)) % list.length;
            if (index2 === index1) {
                index2 = (index1 + 1) % list.length;
            }
            const selectedHost2 = list[index2];

            return { hostMaster: selectedHost1, hostStandby: selectedHost2 };
        }

        const hosts = [
            'Pankaj', 'Anil', 'Manoj', 'Rohan', 'Sneha', 'Bhoomi', 'Kanchan', 'Rohit',
            'Jaipal', 'Chethan', 'Sreeram', 'Purush', 'Paras', 'Arjun', 'Amit',
            'Harsith', 'Sushmitha', 'Deekshith', 'Prakriti', 'Karan', 'Srilakshmi',
            'Sheel', 'Madan', 'Kavya', 'Manish', 'Chirag', 'Karthik', 'Anupriya', 
            'Madhu', 'Pooja', 'Sharmistha', 'Aneesh'
        ];

        /* 'Anusha' */

        function setHost() {
            // Pass the hosts array to the new function
            // Assuming getRotationalHosts(hosts) returns { hostMaster: 'Name1', hostStandby: 'Name2' }
            const { hostMaster, hostStandby } = getRotationalHosts(hosts);

            // Update the display for the Host Master using the correct ID
            document.getElementById('weeklyHost1').innerHTML = `
                Host Master: <span class="host-name"><strong>${hostMaster}</strong></span>
            `;

            // Update the display for the Host Standby using the correct ID
            document.getElementById('weeklyHost2').innerHTML = `
                Host Standby: <span class="host-name"><strong>${hostStandby}</strong></span>
            `;
        }

        // Ensure the setHost() call remains at the end of your script
        setHost();
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
